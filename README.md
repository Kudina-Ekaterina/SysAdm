# Глава 3. Рабочие станции.

Обслуживание операционных систем на рабочих станциях сводится к выполнению трех основных задач: первоначальная установка системного программного обеспечения и приложений, обновление системного программного обеспечения и приложений, настройка сетевых параметров. Эти задачи называются «большой тройкой».

Рабочие станции, как правило, используются в больших количествах и отличаются долгим жизненным циклом (рождение, использование, смерть).

![Жизненный цикл](1.png)

- Чистое состояние относится к машине с установленной, но еще не настроенной ОС.
- Сконфигурированное состояние  означает,  что  система  настроена  и  функционирует должным образом.
- Неизвестное состояние относится к компьютеру, который был неправильно 
сконфигурирован или конфигурация которого устарела.
- Отключенное состояние относится к машине, которая была списана и отключена.

__Энтропия__ – процесс нежелательной амортизации, приводящий компьютер в неизвестное состояние, которое можно исправить с помощью отладки.

__Процесс восстановления__ – это процесс, при котором данные на машине стираются, и система заново устанавливается, возвращая машину к сконфигурированному состоянию.

__Переустановка__ (процесс восстановления) подобна установке с той разницей, что в первом случае, возможно, понадобится перенести старые данные и приложения.

___

С обслуживанием операционных систем рабочей станции связаны три критически важных аспекта:

1.  Первоначальная установка системного ПО и приложений.
2.  Обновление системного ПО и приложений.
3.  Настройка сетевых параметров.

___

Автоматизация решает огромное количество проблем, но не все из них являются техническими. 

Во-первых, автоматизация экономит деньги. Разумеется, одним из основных преимуществ является время, выигранное за счет замены ручных процессов автоматическими. Кроме того, автоматизация устраняет два вида скрытых затрат. 

Первый относится к ошибкам: при ручном выполнении процессов существует вероятность ошибок. Второй тип скрытых затрат относится к неоднородности. Если вы вручную устанавливаете операционную систему, вы никогда не добьетесь той же конфигурации на другой машине.

Второй тип скрытых затрат относится к неоднородности. Если вы вручную устанавливаете операционную систему, вы никогда не добьетесь той же конфигурации на другой машине.

___

__Самый важный аспект автоматизации__ заключается в том, что установка должна быть __полностью автоматизирована__.

Процедуру, требующую возвращения человека посреди установки для ответа на тот или иной вопрос, __нельзя__ назвать полностью автоматизированной, и она теряет эффективность.

___

Частичная автоматизация лучше, чем ее полное отсутствие.

Основная временная мера – документирование всего процесса, которое позволит впоследствии воспроизводить его в точности.

Можно автоматизировать __различные__ этапы установки. 

___

В некоторых сетях для создания новых машин используется клонирование жестких дисков. Клонирование жесткого диска подразумевает создание узла с точной конфигурацией ПО, которая необходима для всех развертываемых узлов. Затем жесткий диск этого узла клонируется (копируется) на все новые компьютеры. Первую машину часто называют __«золотым узлом»__. Вместо того чтобы снова и снова копировать жесткий диск, его содержимое можно скопировать на компакт-диск, ленточный накопитель или файловый сервер, которые впоследствии будут использоваться при установке.

Предпочтение отдаётся автоматизированному процессу установки копированию диска по нескольким причинам:

Во-первых, если по аппаратному обеспечению новая машина значительно отличается от старой, необходимо создать отдельный мастер-образ. 

Во-вторых, наличие резервных машин для каждого типа оборудования, требующего новых образов, значительно повышает расходы и усилия, необходимые для установки.

Поставщики некоторых ОС не поддерживают клонированные диски, так как процесс установки может изменяться на основе таких факторов, как тип обнаруженного оборудования. 

__Можно достичь золотой середины, применяя как автоматизацию, так и клонирование.__

___

Переустановка ОС с нуля предпочтительнее по нескольким причинам: 

Во-первых, прежде чем машина сможет работать в нашей сети, нам потребуется установить другие приложения и локализации поверх установленной поставщиком ОС. Автоматизация всего процесса установки с нуля зачастую проще, чем установка приложений и конфигурирование предустановленной ОС. 

Во-вторых, поставщики вносят изменения в конфигурацию предустановленной ОС в собственных целях, никого об этом не уведомляя. Установка с нуля дает известное состояние каждой машины. Использование предустановленной ОС означает отклонения от стандартной конфигурации. Порой эти отклонения могут вызвать проблемы.

Другая причина для отказа от использования предустановленной ОС – то, что время от времени ОС узлов сети приходится переустанавливать.

___

Всегда можно улучшить согласованность процесса с помощью контрольных списокв, не смотря на то, какой способ ОС был использован (ручной или полностью автоматизированный). Эти списки помогают удостовериться, что техники не пропустят ни одного этапа. Польза таких списков очевидна, если процесс установки полностью выполняется вручную.

Даже если процесс установки ОС полностью автоматизирован, грамотный контрольный список все же может принести пользу. Некоторые действия невозможно автоматизировать, так как их необходимо выполнить физически (например, запустить процесс установки; удостовериться, что мышь работает; протереть экран монитора; предоставить пользователю на выбор несколько ковриков для мыши).

___

Системы обновления ПО должны быть достаточно универсальными, чтобы они позволяли устанавливать новые приложения и обновлять уже имеющиеся, а также устанавливать патчи ОС. Если система способна только устанавливать патчи, __новые приложения можно упаковать и использовать их в качестве патчей__. Такие системы также можно использовать для внесения незначительных изменений на большом количестве узлов сети. Небольшие изменения конфигурации, такие как новый файл /etc/ntp.conf, можно упаковать в патч и установить автоматически. Большинство систем позволяет включать __постустановочные скрипты__ – программы, которые при запуске выполняют изменения, необходимые для установки пакета. Для внесения сложных изменений можно даже создать отдельный пакет, содержащий только постустановочный скрипт.

___

Автоматизация обновления ПО схожа с автоматизацией первичной установки, но между ними есть и несколько существенных различий.

- __Узел сети находится в рабочем состоянии.__ Обновление устанавливается на машины, которые находятся в рабочем состоянии, а при первичной установке необходимо выполнить ряд дополнительных задач, таких как создание разделов на дисках и определение сетевых параметров.
- __Узел сети находится в офисе.__ Система обновления должна быть способна выполнять задачи в собственной сети узла.
- __Отсутствует необходимость в физическом доступе.__ При обновлении ПО нет необходимости в физическом доступе к рабочей станции (что может помешать работе пользователей). Физический  доступ  к  компьютерам автоматизировать нельзя.
- __Узел сети уже используется.__ Обновление ПО проводится на машинах, которые используются на протяжении какого-то времени.
- __Узел сети может не находиться в «известном состоянии».__ Поэтому автоматизация должна быть более точной, так как с момента первичной установки в ОС могли возникнуть ошибки.
- __Узел сети может использоваться сотрудниками в процессе обновления.__ Некоторые обновления невозможно установить в то время, когда машина используется.
- __Узел сети может отсутствовать.__ В эпоху ноутбуков есть большая вероятность того, что узел не присутствует в сети в момент установки обновлений.
- __Узел сети может иметь мультисистемную загрузку.__ В эпоху узлов с  мультисистемной  загрузкой  система  обновления,  предназначенная  для настольных компьютеров, должна точно контролировать доступ к нужной ОС.

__МЕТОД "ОДНА, НЕСКОЛЬКО, МНОГО"__

Можно снизить риск ошибок обновления, применив метод «одна, несколько, много».

- __Одна.__ Прежде всего установите патч на одну машину. Лучше всего на свою собственную – тогда у вас будет дополнительный стимул все сделать правильно. Если при обновлении возникнут ошибки, вносите в процесс изменения до тех пор, пока он не будет работать на одной машине без ошибок.
- __Несколько.__ Далее попробуйте установить патч на несколько других машин. Если это возможно, стоит протестировать автоматизированный процесс обновления  на  рабочих  станциях  остальных  системных  администраторов, прежде чем задействовать машины пользователей. Системные администраторы проявляют чуть больше понимания. Затем протестируйте систему на нескольких  машинах  дружелюбно  настроенных  к  вам  пользователей  (не системных администраторов).
- __Много.__ Протестировав свою систему и убедившись, что она не уничтожит ничей  жесткий  диск,  начинайте  постепенно  переходить  ко  все  большим и большим группам пользователей, нетерпимых к риску.

___

Третий компонент, необходимый для сетей, объединяющих большое количество рабочих станций, – это __способ автоматизации обновления сетевых параметров__ – тех считанных битов информации, от которой часто зависит загрузка компьютеров и их объединение в сеть.

Наиболее распространенная система автоматизации этого процесса – __DHCP__.

___

__Системы DHCP должны иметь систему шаблонов.__ Некоторые системы DHCP хранят отдельные параметры, присвоенные каждому отдельному узлу сети. Другие системы DHCP хранят шаблоны, описывающие, какие параметры присваиваются узлам различных классов. __Преимущество шаблонов__ в том, что при внесении изменений на множестве узлов вам нужно будет просто изменить шаблон, что значительно лучше, чем прокручивать длинный список узлов сети, пытаясь найти те, которые требуется изменить. Еще одно преимущество в том, что значительно уменьшается вероятность появления ошибки в синтаксисе, если конфигурационный файл генерируется программой. Исходя из того, что шаблоны синтаксически правильны, конфигурация тоже будет верной.

___

Как правило, __DHCP назначает отдельный IP-адрес каждому узлу сети__. Функция динамической аренды адресов позволяет указать диапазон IP-адресов, которые можно присваивать узлам сети. Эти узлы смогут при каждом подключении к сети получать новый IP-адрес. __Преимущество__ в том, что облегчается работа администраторов и повышается удобство для пользователей.

Динамическое распределение следует использовать в случаях, когда много узлов конкурируют за малое количество IP-адресов. Типичная офисная локальная сеть лучше подходит для динамически назначаемой аренды.

__Причина для назначения статических IP-адресов – повышение удобства использования файлов журнала. Использование только статических IP-адресов не является достаточной мерой для БЕЗОПАСНОСТИ.__

___

Решение __plug-in-and-go__ (подключись-и-работай) представляет собой выделение пространства адресов и возможность проверки, есть ли у пользователей разрешение на использование ресурсов корпорации, университета или отеля.

___

Простые ошибки одних пользователей могут помешать работе других. Клиентам нельзя позволять выбирать собственные имена узлов, самим устанавливать IP-адреса. Использование DHCP в значительной мере снижает шанс таких ситуаций.

Динамический DNS-сервер с DHCP создает систему, которая является более запутанной, более сложной для управления, более подверженной сбоям и __менее безопасной__.

Ограничение распространения означает __ограничение риска безопасности__ таким образом, чтобы он распространялся только в пределах определенной области. Рекомендуется ограничивать динамический DNS-сервер определенными сетевыми субдоменами, от которых не требуется высокая надежность.

___

Управление сроками аренды может помочь в распределении обновлений. DHCP-клиентам задается определенный набор параметров, который будет использоваться в течение определенного периода времени. По истечении этого периода они должны обновить свою аренду. Изменения вносятся во время обновления.

___

В идеале пользователи должны принимать участие в процессе разработки с самого начала. Назначенные представители или заинтересованные руководители могли бы выбирать приложения, которые будут включены в конфигурацию. Для каждого приложения составляется соглашение об уровне обслуживания, в котором описывается уровень обслуживания со стороны системных администраторов. Новые версии ОС и приложений отслеживаются и одобряются. Контролируемое внедрение новых версий аналогично описанному автоматизированному процессу обновления.

Однако в реальности платформы контролируются либо руководством, либо отделом системного администрирования, отвечающим за предоставление основной платформы, которую пользователи могут настраивать под себя. 

В первом случае примером может служить офис приема заказов по телефону, где операторы работают со строго определенным набором приложений. Системные администраторы совместно с руководством определяют, какие именно приложения будут установлены, когда именно будет проведено обновление и т. д.

Вторые случаи более распространенны. В одной сети стандартной платформой для персонального компьютера считается его операционная система; самые необходимые приложения; приложения, требуемые компанией-учредителем; утилиты, которые наиболее часто просят установить пользователи и которые можно лицензировать оптом. Такая среда является очень открытой.

Для некоторых приложений предусмотрены более формальные процессы.

___

Чем больше стандартных конфигураций используется в корпоративной сети, тем труднее все их обслуживать. __Один из способов создать большое количество разнообразных конфигураций__ – использовать для всех конфигураций один и тот же сервер и механизмы, вместо того чтобы выделить отдельный сервер для каждого стандарта. Однако можно потратить время и создать __единую обобщенную систему__, способную производить множественные конфигурации и поддаваться масштабированию.

Общее понятие управляемых стандартизированных конфигураций часто носит название __«управление конфигурацией программного обеспечения»__ (Software Configuration Management, SCM). Этот процесс относится как к серверам, так и настольным компьютерам.

Стандартные конфигурации также могут облегчить процесс обновления ОС.

___

# Глава 4. Серверы.

В отличие от рабочих станций, предназначенных для одного пользователя, от сервера зависит множество пользователей. Следовательно, __главным приоритетом для них становится надежность и бесперебойная работа.__

Все усилия по повышению производительности или надежности наталкиваются на барьер огромного количества пользователей. Cерверы рассчитываются на более продолжительное времени работы, чем рабочие станции, что также подразумевает дополнительные расходы. Покупка сервера с избыточной мощностью становится вложением в продление его срока жизни.

___

Как правило, серверы поставляются с контрактом на обслуживание, системами резервного копирования, операционной системой и возможностью удаленного доступа. Кроме того, серверы размещают в вычислительных центрах с контролируемым микроклиматом и с ограниченным доступом к серверному оборудованию.

___

Серверное оборудование обычно стоит дороже, но дополнительные возможности оправдывают вложения. Вот некоторые из этих __возможностей__:

- __Расширяемость.__
- __Большая производительность	центральных процессоров.__
- __Высокопроизводительные системы обмена информацией (ввода-вывода).__
- __Возможности модернизации.__
- __Возможность монтирования	в стойку.__
- __Не требуется доступ с боковых сторон.__
- __Дополнения для повышенной надежности.__
- __Контракт на обслуживание.__
- __Альтернативные варианты управления.__

___

__Очень важно выбирать поставщиков, продукция которых известна своей надежностью.__

Можно порекомендовать для общения два ресурса сообщества системных администраторов: SAGE (System Administrators’ Guild, Гильдия системных администраторов, www.sage.org) и LOPSA (League of Professional System Administrators, Лига профессиональных системных администраторов, www.lopsa.org).

Оборудование может быть однотипным (все от одного поставщика и/или из одной линейки продукции) или разнотипное (от разных поставщиков и/или из разных линеек продукции).

__Однотипное__ оборудование проще обслуживать, так как требуется меньше времени на подготовку; обслуживание и ремонт упрощаются за счет одного набора запасных частей, а также легче найти виновных в случае возникновения проблем. 

Однако __разнотипное__ оборудование тоже имеет свое преимущество – оно заключается в том, что вы не зависите от одного поставщика, а конкуренция между поставщиками обернется для вас лучшим обслуживанием.

___

У большинства поставщиков есть __три серии продукции__: для дома, для бизнеса и серверное оборудование. Домашняя серия обычно продается по наименьшей начальной цене, так как клиенты чаще всего принимают решение о покупке на основании рекламируемой цены. Настольные компьютеры для бизнеса обычно разрабатываются с учетом общих затрат в течение всего срока их службы. Начальная закупочная цена выше, чем для домашних компьютеров, но серия для бизнеса должна дольше не устаревать. Серверные серии обычно ориентированы на наилучшее соотношение себестоимости и производительности.

__Весомый аргумент против решения о приобретении дорогого сервера: его производительность выше, чем это требуется для службы.__

___

Вот несколько разумных __сценариев__, которые помогут при выборе подходящего контракта на обслуживание:

- __Не критически важный сервер.__
- __Большая группа идентичных серверов.__
- __Постепенная модернизация.__
- __Важные узлы.__
- __Большое количество моделей от одного поставщика.__
- __Критически важный узел.__

__Нужно искать компромисс между хранением запасных частей и сервисным контрактом.__

Есть три простых способа предотвратить забывание включения оборудования в контракт. 

__Первый способ__ заключается в том, чтобы создать хорошую систему инвентаризации и использовать ее для перекрестного пересмотра контракта. Однако хорошую систему инвентаризации трудно найти, и даже лучшие из них могут пропустить несколько узлов.

__Второй способ__ заключается в том, чтобы человек, ответственный за закупки, также отвечал за добавление новых машин в контракт. Этот человек должен знать, к кому обращаться для определения соответствующего уровня обслуживания. Если нет единого отдела закупок, можно попробовать найти какую-то другую процедуру добавления новых узлов в контракт.

__Третий способ__ – решить общие проблемы, связанные с гарантией.

---

Контракты на обслуживание, скорее, борются с последствиями, а не предотвращают  проблемы.

---

Налаженный обмен новых компонентов на старые – важная часть оперативного ремонта, и __в идеале__ она должна быть предусмотрена в контракте на обслуживание.

Еще больше сократить время на ремонт можно, приобретя комплект запасных компонентов, снимающий зависимость от поставщика при срочном ремонте сервера. В комплект должно входить по одному экземпляру __каждого__ компонента системы.

___

Серверы должны устанавливаться в условиях с надежными энергоснабжением,  противопожарной защитой, сетью, охлаждением и физической безопасностью. Лучше всего зарезервировать физическое место для размещения сервера при его приобретении. Если пометить места в соответствующих стойках распечатанными метками, это предотвратит повторное резервирование места. Для разметки мест энергоснабжения и охлаждения потребуется сверяться по списку или таблице. После сборки оборудование лучше устанавливать в стойку непосредственно перед установкой ОС и другого программного обеспечения.

___

Серверы необязательно должны работать под управлением тех же ОС, что и их клиенты. Серверы могут быть совершенно другими, в точности такими же, или с той же базовой ОС, но с другой конфигурацией для иного предназначения. Иногда на серверах требуется устанавливать все те же программы, что и на клиентах.

___

Для серверов __необходима__ возможность удаленного обслуживания.

__Переключатель КВМ__ – устройство, позволяющее нескольким машинам использовать одну клавиатуру, видеоэкран и мышь (КВМ). Предшественник переключателя КВМ был предназначен для устройств с последовательным портом.

В настоящее время __последовательные консольные концентраторы__ бывают двух видов: самодельные и специализированные. 

__Самодельное решение__ подразумевает следующее: вы берете машину с множеством последовательных портов и программное обеспечение (бесплатное, такое как ConServer, или коммерческий аналог) и сами создаете систему. 

__Специализированное решение__ – готовая система от поставщика, которая обычно быстрее поддается настройке и оснащена программным обеспечением в виде прошивки или на твердотельном накопителе на флэш-памяти.

Последовательные консоли и переключатели КВМ дают следующее __преимущество__: они позволяют вам управлять системной консолью, если сеть не работает или если система в неисправном состоянии. Сетевые устройства, такие как маршрутизаторы и коммутаторы, оснащены только последовательными консолями.

---

Удаленный доступ к консолям позволяет системным администраторам снизить затраты и улучшить факторы безопасности. Машинные залы оптимизированы для машин, а не для людей. 

---

___

Загрузочный диск, или диск с операционной системой, как правило, труднее всего заменить в случае его повреждения. Поэтому необходимо соблюдать особые меры безопасности, чтобы ускорить процесс восстановления. Для загрузочного диска каждого сервера необходимо создать __зеркальный диск__.

__Зеркалирование__ предполагает определенные компромиссы в отношении производительности. Операции чтения производятся быстрее, так как чтение идет параллельно с двух дисков.

Благодаря зеркальному копированию сбой жесткого диска является событием, которое можно контролировать. Если неисправный диск можно заменить во время работы системы, сбой в работе одного компонента не приведет к простою. Если неисправные диски можно заменять только при отключенной системе, перерыв в работе можно запланировать в соответствии с потребностями компании. Благодаря этому простои в работе мы можем контролировать.

__Зеркальное RAID-копирование защищает от сбоев оборудования. Оно не защищает от программных или пользовательских ошибок.__

___

__Одноцелевое устройство__ – устройство, созданное для выполнения одной конкретной задачи. Те же действия можно выполнять и с помощью универсальных устройств, но есть определенные преимущества при использовании устройств, предназначенных для качественного выполнения одной конкретной задачи.

__Одноцелевой сервер__ представляет собой устройство, в котором воплотился многолетний опыт. Конструирование сервера – сложный процесс. Преимущество одноцелевых устройств – наличие возможностей, которых больше нигде нет.

___

__В идеале__ серверы должны быть обеспечены резервными блоками питания.

Наличие резервных блоков питания означает, что система сохраняет работоспособность, если один из блоков питания не функционирует: избыточность n + 1. В некоторых случаях системе при полной нагрузке требуется два блока питания для обеспечения достаточной мощности. В этом случае избыточность обеспечивается тремя блоками питания. У каждого блока питания должен быть отдельный кабель питания. 

___

__Избыточность n + 1__ относится к системам, которые спроектированы таким образом, что система продолжает функционировать даже после сбоя одного из компонентов. Примером такой системы являются RAID-массивы, которые продолжают полноценно функционировать даже после выхода из строя одного из дисков, или коммутатор Ethernet с дополнительной многовходовой системой коммутации, который позволяет передавать трафик даже после сбоя одного из сегментов системы коммутации.

При полной избыточности два полных набора оборудования объединены в отказоустойчивую конфигурацию. Первая система обеспечивает исполнение службы, а вторая бездействует в полной готовности взять на себя работу при сбое первой системы. Переключение на резервные мощности может осуществляться вручную (кто-то замечает сбой в первой системе и активирует вторую) или автоматически (вторая система отслеживает работу первой системы и сама активируется при ее отказе).

Другие системы с полной избыточностью используют распределение нагрузки. Обе системы полноценно функционируют и распределяют между собой рабочую нагрузку.

Если n равно или больше 2, n + 1 выгоднее, чем полная избыточность. Как правило, избыточность n + 1 используется только для серверных подсистем, а не для всех видов компонентов.

___

Резервные компоненты должны поддерживать «горячую» замену. __«Горячая» замена__ подразумевает возможность отключить и заменить компонент во время работы системы.

Первое __преимущество__ «горячей» замены – возможность устанавливать компоненты во время работы системы. При избыточности n + 1 система может перенести сбой только одного компонента. Именно поэтому критически важно как можно быстрее заменить нерабочий компонент, чтобы нейтрализовать риск двойного сбоя компонентов.

Компоненты с возможностью «горячей» замены повышают стоимость системы.

___

Способ разместить большое количество машин на ограниченном пространстве – использовать __технологию блейд-серверов__. Один корпус содержит множество ячеек, в каждую из которых можно подключить плату (блейд) с процессором и памятью. Корпус обеспечивает питание, доступ к сети и системе управления. В некоторых случаях каждая плата оснащена жестким диском. В других случаях у каждой платы должен быть доступ к центральной сети хранения данных. Так как все устройства схожи друг с другом, можно создать автоматизированную систему, которая позволяет заменить неисправное устройство свободным.
